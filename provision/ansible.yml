---
 - hosts: all
   tasks:
   - name: Ensure dependencies are installed.
     pkgng: name={{item}} state=present cached=true
     with_items:
     - git
     - lang/go

   - name: Create lo1 interface for jetpack
     command: "ifconfig lo1 create inet 172.23.0.1/16"
     ignore_errors: yes

   - name: Enable ip forwarding so containers can haz nat
     sysctl: name=net.inet.ip.forwarding value=1 state=present

   - name: Build Jetpack
     command: "{{ item }}"
     args:
       chdir: "/vagrant"
     with_items:
     - "make PREFIX=/usr/local"
     - "make install PREFIX=/usr/local"
   
   - name: Init Jetpack
     command: "jetpack init"
     ignore_errors: yes

