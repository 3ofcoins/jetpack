---
 - hosts: all
   tasks:
   - name: Ensure dependencies are installed.
     pkgng: name={{item}} state=present cached=true
     with_items:
     - git
     - lang/go
     - debootstrap

   - name: Enable ip forwarding so containers can haz nat
     sysctl: name=net.inet.ip.forwarding value=1 state=present

   - name: Create lo1 interface for jetpack
     command: "{{ item }}"
     with_items:
     - "kldload pf fdescfs linprocfs linsysfs tmpfs"
     - "ifconfig lo1 create inet 172.23.0.1/16"
     ignore_errors: yes

   - name: "Copy pf.conf"
     copy: src=etc/pf.conf dest="/etc/pf.conf"

   - name: Reload PF
     command: "/etc/rc.d/pf onerestart"

   - name: Build Jetpack
     command: "{{ item }} PREFIX=/usr/local"
     args:
       chdir: "/vagrant"
     with_items:
     - "make"
     - "make install"
   
   - name: Init Jetpack
     command: "jetpack init"
     ignore_errors: yes

